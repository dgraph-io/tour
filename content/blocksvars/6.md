+++
date = "2017-05-01T20:48:32+10:00"
next = "/blocksvars/7"
prev = "/blocksvars/5"
title = "Exercise: Query Variables linking queries"
weight = 6
course = 5
courseName = "Var Blocks"
+++

We've seen two common uses for variables: filtering and reorganizing results.
Another is linking two queries to gain some new insight based on the joined
results.

### Example: Joining two queries

Here's a simple example that finds actors who have appeared in both Comedy and
Horror films:

```
{
  # Store all actors from Comedy films
  var(func: eq(name@en, "Comedy")) {
    ~genre {
      starring {
        A_C as performance.actor
      }
    }
  }

  # Store all actors from Horror films
  var(func: eq(name@en, "Horror")) {
    ~genre {
      starring {
        A_H as performance.actor
      }
    }
  }

  # Find actors in BOTH sets using @filter
  actors_in_both_genres(func: uid(A_C)) @filter(uid(A_H)) {
    name@en
  }
}
```

The pattern is:
1. **Query 1**: Collect UIDs into variable `A_C` (Actors in Comedy)
2. **Query 2**: Collect UIDs into variable `A_H` (Actors in Horror)
3. **Query 3**: Start with `uid(A_C)` and filter by `uid(A_H)` to get the intersection

### Exercise

Now try it yourself:

For two directors find the actors who have worked with both (not necessarily on
the same movie). Many directors won't have actors in common, so start with some
you are sure will (the answer below uses Peter Jackson and Martin Scorsese who
have a small number of actors in common).

As an optional challenge, for each of those actors list the movies they have
made with either director.

{{% expandable %}}

```
{
  var(func: allofterms(name@en, "Peter Jackson")) {
    F_PJ as director.film {
      starring{
        A_PJ as performance.actor
      }
    }
  }

   var(func: allofterms(name@en, "Martin Scorsese")) {
    F_MS as director.film {
      starring{
        A_MS as performance.actor
      }
    }
  }

  actors(func: uid(A_PJ)) @filter(uid(A_MS)) @cascade {
    actor: name@en
    actor.film {
      performance.film @filter (uid(F_PJ, F_MS)) {
      	name@en
      }
    }
  }
}
```

The syntax `uid(F_PJ, F_MS)` means the UIDs in either `F_PJ` or `F_MS` and is
equivalent to `uid(F_PJ) OR uid(F_MS)`. {{% /expandable %}}
